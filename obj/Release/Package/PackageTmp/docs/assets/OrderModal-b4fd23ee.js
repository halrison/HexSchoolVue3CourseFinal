import{m as g,s as q,o as M,O as L,G as B,d as a,e as d,h as s,t as c,g as t,F as f,i as O,q as r,S as p,Q as i,Z as T}from"./index-76d5b82d.js";import{u as E}from"./coupons-3eb6210c.js";const F={class:"modal-dialog modal-lg",role:"dialog"},N={class:"modal-content"},$={class:"modal-header"},G={class:"modal-body"},Q={class:"table"},R={class:"container"},Z={class:"row"},z=s("th",{class:"col"},"建立日期",-1),A={class:"col"},H=s("th",{class:"col"},"付款日期",-1),I={class:"col"},J={class:"container"},K=s("tr",{class:"row"},[s("th",{class:"col-6"},"商品名稱"),s("th",{class:"col"},"單價"),s("th",{class:"col"},"數量"),s("th",{class:"col text-end"},"小計")],-1),P={class:"row"},W={class:"col-6"},X={class:"col text-end"},Y=["onUpdate:modelValue","onChange"],ss={class:"col text-end"},ts=["onUpdate:modelValue","onChange"],os={class:"col text-end"},es={key:0,class:"row"},cs=s("td",{class:"col"},"折扣",-1),ls={class:"col text-end"},ns=s("td",{class:"col"},"優惠價",-1),as={class:"col text-end"},ds={key:1,class:"row"},_s=s("th",{class:"col-9"},"合計",-1),is={class:"col text-end"},rs={class:"container"},ps={class:"row"},hs=s("th",{class:"col-3"},"地址",-1),us={class:"col"},ms={class:"row"},bs=s("th",{class:"col-3"},"電子信箱",-1),fs={class:"col"},ys={class:"row"},vs=s("th",{class:"col"},"姓名",-1),xs={class:"col"},ws=s("th",{class:"col"},"電話",-1),gs={class:"col"},Os={class:"modal-body"},ks={class:"container"},Ds={class:"row"},Vs=s("span",{class:"col"},"建立日期",-1),Ss={class:"col"},Us=s("span",{class:"col"},"付款日期",-1),Cs={class:"col"},js={class:"row"},qs=s("span",{class:"col-3"},"留言",-1),Ms={class:"col"},Ls=s("hr",null,null,-1),Bs={class:"container"},Ts=T('<p class="row"><span class="col">商品名稱</span><span class="col text-end">單價</span><span class="col text-end">數量</span><span class="col text-end">小計</span></p>',1),Es={class:"row"},Fs={class:"col"},Ns={class:"col text-end"},$s={class:"col text-end"},Gs={class:"col text-end"},Qs={key:0,class:"row"},Rs=s("span",{class:"col-9 text-end"},"總計",-1),Zs={class:"col-3 text-end border-top border-danger"},zs=s("span",{class:"col-3"},"折扣",-1),As={class:"col-3 text-end"},Hs=s("span",{class:"col-3 text-end"},"優惠價",-1),Is={class:"col-3 text-end border border-danger"},Js=s("br",null,null,-1),Ks=s("span",{class:"text-info text-end"},"四捨五入至整數位，些微誤差不影響付款",-1),Ps={key:1,class:"row"},Ws=s("span",{class:"col-9 text-end"},"合計",-1),Xs={class:"col text-end border-top border-danger"},Ys=s("hr",null,null,-1),st={class:"container"},tt={class:"row"},ot=s("span",{class:"col-3"},"地址",-1),et={class:"col"},ct={class:"row"},lt=s("span",{class:"col-3"},"電子信箱",-1),nt={class:"col"},at={class:"row"},dt=s("span",{class:"col"},"姓名",-1),_t={class:"col"},it=s("span",{class:"col"},"電話",-1),rt={class:"col"},ut={__name:"OrderModal",props:["order","type"],setup(k,{expose:D}){const y=g(null),v=g(null),u=k,x=E(),{editOrder:V,getOrder:S,getOrders:U}=x,{order:e,user:n}=q(x);let m;M(function(){m=new L(y.value)}),D({show:C}),B(()=>u.order,async function(h){await S(h.id),n.value=e.value.user||h.user},{deep:!0});function C(){m.show()}function b(){m.hide(),U(1,u.type)}function w(h){const l=Object.values(e.value.products).find(o=>o.id===h);e.value.total-=l.total,l.total=l.qty*l.product.price,e.value.total+=l.qty*l.product.price}function j(){V(),v.value.checkValidity()&&b()}return(h,l)=>(a(),d("div",{class:"modal fade",tabindex:"-1",ref_key:"DOM",ref:y},[s("div",F,[s("div",N,[s("div",$,"訂單編號："+c(t(e).id),1),u.type==="admin"?(a(),d("form",{key:0,ref_key:"form",ref:v},[s("div",G,[s("table",Q,[s("thead",R,[s("tr",Z,[z,s("td",A,c(new Date(t(e).create_at*1e3).toLocaleDateString()),1),H,s("td",I,c(t(e).paid_date?new Date(t(e).paid_date*1e3).toLocaleDateString():"等待付款中"),1)])]),s("tbody",J,[K,(a(!0),d(f,null,O(t(e).products,o=>(a(),d("tr",P,[s("td",W,c(o.product.title),1),s("td",X,[r(s("input",{"onUpdate:modelValue":_=>o.product.price=_,type:"number",class:"form-control",onChange:_=>w(o.id),min:"1"},null,40,Y),[[p,o.product.price,void 0,{number:!0}]])]),s("td",ss,[r(s("input",{"onUpdate:modelValue":_=>o.qty=_,type:"number",class:"form-control",onChange:_=>w(o.id),min:"1"},null,40,ts),[[p,o.qty,void 0,{number:!0}]])]),s("td",os,c(t(i)(o.total)),1)]))),256)),Object.values(t(e).products||{}).some(o=>o.coupon)?(a(),d("tr",es,[cs,s("td",ls,c(Object.values(t(e).products||{}).reduce((o,_)=>o+_.total-_.final_total,0)),1),ns,s("td",as,c(t(i)(t(e).total)),1)])):(a(),d("tr",ds,[_s,s("td",is,c(t(i)(t(e).total)),1)]))]),s("tfoot",rs,[s("tr",ps,[hs,s("td",us,[r(s("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>t(n).address=o),type:"text",class:"form-control w-100"},null,512),[[p,t(n).address]])])]),s("tr",ms,[bs,s("td",fs,[r(s("input",{"onUpdate:modelValue":l[1]||(l[1]=o=>t(n).email=o),type:"email",class:"form-control w-100"},null,512),[[p,t(n).email]])])]),s("tr",ys,[vs,s("td",xs,[r(s("input",{"onUpdate:modelValue":l[2]||(l[2]=o=>t(n).name=o),type:"text",class:"form-control"},null,512),[[p,t(n).name]])]),ws,s("td",gs,[r(s("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>t(n).tel=o),type:"tel",class:"form-control"},null,512),[[p,t(n).tel]])])])])])]),s("div",{class:"modal-footer"},[s("button",{class:"btn btn-primary",onClick:j},"確定"),s("button",{class:"btn btn-danger",onClick:b},"取消")])],512)):(a(),d(f,{key:1},[s("div",Os,[s("div",ks,[s("p",Ds,[Vs,s("span",Ss,c(new Date(t(e).create_at*1e3).toLocaleDateString()),1),Us,s("span",Cs,c(t(e).paid_date?new Date(t(e).paid_date*1e3).toLocaleDateString():"等待付款中"),1)]),s("p",js,[qs,s("span",Ms,c(t(e).message),1)])]),Ls,s("div",Bs,[Ts,(a(!0),d(f,null,O(t(e).products,o=>(a(),d("p",Es,[s("span",Fs,c(o.product.title),1),s("span",Ns,c(o.product.price),1),s("span",$s,c(o.qty),1),s("span",Gs,c(t(i)(o.total)),1)]))),256)),Object.values(t(e).products||{}).some(o=>o.coupon)?(a(),d("p",Qs,[Rs,s("span",Zs,c(t(i)(t(e).total*100/Object.values(t(e).products)[0].coupon.percent)),1),zs,s("span",As,c(t(i)(t(e).total*100/Object.values(t(e).products)[0].coupon.percent-t(e).total)),1),Hs,s("span",Is,c(t(i)(t(e).total)),1),Js,Ks])):(a(),d("p",Ps,[Ws,s("span",Xs,c(t(i)(t(e).total)),1)]))]),Ys,s("div",st,[s("p",tt,[ot,s("span",et,c(t(n).address),1)]),s("p",ct,[lt,s("span",nt,c(t(n).email),1)]),s("p",at,[dt,s("span",_t,c(t(n).name),1),it,s("span",rt,c(t(n).tel),1)])])]),s("div",{class:"modal-footer"},[s("button",{class:"btn btn-primary",onClick:b},"返回")])],64))])])],512))}};export{ut as _};
