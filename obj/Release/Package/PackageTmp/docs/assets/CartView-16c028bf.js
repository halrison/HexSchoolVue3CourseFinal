import{B as G,s as B,u as H,b as J,l as K,m as r,R as U,o as W,r as g,d as a,e as i,f as l,g as o,L as X,w as Y,F as E,h as t,i as Z,t as _,q as L,S as F,n as m,P as tt,Q as f,C as N,T as st,U as et,V as ot}from"./index-76d5b82d.js";import{u as lt}from"./coupons-3eb6210c.js";import{_ as nt}from"./RemoveModal-8875dbfd.js";import"./articles-c7527420.js";const at={class:"table table-borderless mx-auto w-100"},dt=t("thead",null,[t("tr",{class:"row"},[t("th",{class:"col-1"},"刪除"),t("th",{class:"col-6"},"品名"),t("th",{class:"col-2 text-end"},"數量"),t("th",{class:"col-3 text-end"},"小計")])],-1),it={class:"col-1"},ct=["onClick"],ut=t("i",{class:"bi bi-cart-x-fill"},null,-1),rt=[ut],_t={class:"col-6"},mt={class:"col-2 text-end"},ht={class:"input-group d-inline-block"},vt={class:"input-group bg-light rounded"},pt={class:"input-group-prepend"},bt=["onClick","disabled"],gt=t("i",{class:"bi bi-dash"},null,-1),ft=[gt],yt=["onUpdate:modelValue","onChange"],xt={class:"input-group-append"},Ct=["onClick"],Vt=t("i",{class:"bi-plus bi"},null,-1),kt=[Vt],wt={key:0,class:"text-danger"},qt={key:1,class:"text-danger"},St={class:"col-3 text-end"},$t={key:0,class:"row"},Ut=t("th",{class:"col-6"},null,-1),Lt=t("td",{class:"col-3 text-end"},"總計",-1),Ft={class:"col-3 text-end"},Mt={key:1,class:"row"},Bt=t("th",{class:"col-1"},"折扣",-1),Et={class:"col-6"},Nt=t("th",{class:"col-2 text-end"},"優惠價",-1),Ot={class:"col-3 text-end"},Rt={class:"input-group"},Tt=t("label",{class:"input-group-text",for:"code"},"輸入優惠碼",-1),Pt=t("i",{class:"bi bi-percent"},null,-1),Dt=t("i",{class:"bi bi-cart-x"},null,-1),zt=t("hr",null,null,-1),It={class:"text-center"},Qt={class:"row"},jt=t("div",{class:"col-3"},"姓名",-1),At={class:"col-9"},Gt={class:"row"},Ht=t("div",{class:"col-3"},"地址",-1),Jt={class:"col-9"},Kt={class:"row"},Wt=t("div",{class:"col-3"},"電話",-1),Xt={class:"col-9"},Yt={class:"row"},Zt=t("div",{class:"col-3"},"電子信箱",-1),ts={class:"col-9"},ss={class:"row"},es=t("div",{class:"col-3"},"留言",-1),os={class:"col-9"},ls={class:"row"},ns={class:"my-1"},as=["onSubmit"],ds={key:1,class:"text-center"},hs={__name:"CartView",setup(is){const y=G(),{getCarts:O}=y,{cartItem:x,cartList:c,total:C,final_total:h}=B(y),{isLoading:R}=B(H()),T=lt(),{pushMessage:M}=J(),P=K(),V=r(""),k=r(""),w=r(""),q=r(null),n=r({});U("min",et),U("max",ot),U("isPhone",d=>/(^0[2-8]{1}\d{7,8}$|^09\d{8}$)/.test(d)||"格式不符"),W(async function(){await O()});async function D(){await T.addOrder(n.value,V.value),c.value=[],P.push({path:"/order"})}function z(d){st.post("/api/halrison/coupon",{data:{code:d}}).then(function(e){e.data.success?(M("success",e.data.message,`優惠價為${e.data.data.final_total}`),h.value=e.data.data.final_total):M("danger",e.data.message)})}function S(d,e){x.value=c.value.find($=>$.id===d),e.toString().includes(".")||y.editCart(e)}function I(d){x.value=c.value.find(e=>e.id===d),k.value="單一購物車",q.value.show()}function Q(){k.value="所有購物車",q.value.show()}return(d,e)=>{const $=g("LoadingC"),v=g("FieldC"),p=g("ErrorMessage"),j=g("FormC");return a(),i(E,null,[l($,{active:o(R),"is-full-page":!0},null,8,["active"]),o(c).length?(a(),X(j,{key:0,class:"container",onSubmit:D},{default:Y(({errors:b,validate:A})=>[t("table",at,[dt,t("tbody",null,[(a(!0),i(E,null,Z(o(c),(s,cs)=>(a(),i("tr",{class:"row",key:s.id},[t("td",it,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:u=>I(s.id)},rt,8,ct)]),t("td",_t,_(s.product.title),1),t("td",mt,[t("div",ht,[t("div",vt,[t("div",pt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",onClick:u=>S(s.id,s.qty-1),disabled:s.qty<2},ft,8,bt)]),L(t("input",{type:"text",class:m(["form-control border-0 text-center my-auto shadow-none bg-light",{"is-invalid":!s.qty||s.qty.toString().includes(".")}]),required:"",min:"1","aria-label":"Example text with button addon","aria-describedby":"button-addon1","onUpdate:modelValue":u=>s.qty=u,onChange:u=>S(s.id,s.qty)},null,42,yt),[[F,s.qty,void 0,{number:!0}]]),t("div",xt,[t("button",{class:"btn btn-outline-dark border-0 py-2",type:"button",onClick:u=>S(s.id,s.qty+1)},kt,8,Ct)])])]),s.qty?s.qty.toString().includes(".")?(a(),i("span",qt,"商品數量需為整數")):tt("",!0):(a(),i("span",wt,"商品數量為必填"))]),t("td",St,_(o(f)(s.total)),1)]))),128))]),t("tfoot",null,[o(h)===o(C)?(a(),i("tr",$t,[Ut,Lt,t("td",Ft,_(o(f)(o(C))),1)])):(a(),i("tr",Mt,[Bt,t("td",Et,_(o(f)(o(C)-o(h))),1),Nt,t("td",Ot,_(o(f)(o(h))),1)]))])]),t("div",Rt,[Tt,L(t("input",{class:"form-control",id:"code",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s)},null,512),[[F,w.value]]),t("button",{class:"btn btn-secondary",onClick:e[1]||(e[1]=s=>z(w.value))},[Pt,N(" 套用優惠碼 ")]),t("button",{class:"btn btn-danger",onClick:Q},[Dt,N(" 清空購物車 ")])]),zt,t("div",It,[t("div",Qt,[jt,t("div",At,[l(v,{class:m(["form-control",{"is-invalid":b.name}]),rules:"required",name:"name",label:"姓名",modelValue:n.value.name,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.name=s)},null,8,["modelValue","class"]),l(p,{class:"text-danger",name:"name"})])]),t("div",Gt,[Ht,t("div",Jt,[l(v,{class:m(["form-control",{"is-invalid":b.address}]),rules:"required",name:"address",label:"地址",modelValue:n.value.address,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.address=s)},null,8,["modelValue","class"]),l(p,{class:"text-danger",name:"address"})])]),t("div",Kt,[Wt,t("div",Xt,[l(v,{class:m(["form-control",{"is-invalid":b.tel}]),rules:"required|isPhone",name:"tel",label:"電話",modelValue:n.value.tel,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.tel=s)},null,8,["modelValue","class"]),l(p,{class:"text-danger",name:"tel"})])]),t("div",Yt,[Zt,t("div",ts,[l(v,{class:m(["form-control",{"is-invalid":b.email}]),name:"email",rules:"required|email",label:"電子信箱",modelValue:n.value.email,"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.email=s)},null,8,["modelValue","class"]),l(p,{class:"text-danger",name:"email"})])]),t("div",ss,[es,t("div",os,[L(t("textarea",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=s=>V.value=s),rows:"2",cols:"20"},null,512),[[F,V.value]])])]),t("div",ls,[t("div",ns,[t("button",{class:"btn btn-primary",type:"submit",onSubmit:A},"前往付款",40,as)])])])]),_:1})):(a(),i("h1",ds,"未選購任何商品")),l(nt,{ref_key:"modal",ref:q,item:o(x),type:k.value},null,8,["item","type"])],64)}}};export{hs as default};
