import{m as y,s as F,o as I,O as B,G as z,r as M,d as p,e as b,h as e,f as s,w as R,t as h,g as o,n as _,W as G,X as W,Y as X,F as D,i as L,C as Y,P as j,q as A,S as T,x as H,u as J,c as E,v as K}from"./index-76d5b82d.js";import{u as q}from"./articles-c7527420.js";import{_ as Q}from"./PaginationBar-07a76f54.js";import{_ as Z}from"./RemoveModal-8875dbfd.js";import"./coupons-3eb6210c.js";const ee={class:"modal-dialog",role:"dialog"},te={class:"modal-header"},le={class:"modal-body container"},ae={class:"row py-1"},oe=e("div",{class:"col-3"},[e("label",{for:"title"},"標題")],-1),se={class:"col-9"},ne={class:"row py-1"},ie=e("div",{class:"col-3"},[e("label",{for:"image"},"圖片")],-1),de={class:"col-9"},ce=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),re=e("br",null,null,-1),ue={class:"mb-3 input-group"},me=["disabled"],ve={class:"mb-3"},_e=e("label",{for:"input",class:"form-label"},"或上傳圖片",-1),pe={class:"row py-1"},be=e("div",{class:"col-3"},[e("label",{for:"tag"},"標籤")],-1),fe={class:"col-9"},ge={key:0},he=["onClick"],ye={class:"input-group"},ke={class:"row py-1"},we=e("div",{class:"col-3"},[e("label",{for:"description"},"描述")],-1),Ce={class:"col-9"},Ve={class:"row py-1"},xe=e("div",{class:"col-3"},[e("label",{for:"content"},"內容")],-1),Me={class:"col-9"},Ae={class:"row py-1"},Se=e("div",{class:"col-3"},[e("label",{for:"author"},"作者")],-1),$e={class:"col-9"},De={class:"row"},Ue=e("div",{class:"col"},[e("label",{class:"form-check-label",for:"public"},"是否公開")],-1),Te={class:"col"},Ee=e("div",{class:"col"},[e("label",{for:"date"},"建立日期")],-1),Fe={class:"col"},Ie=e("div",{class:"modal-footer"},[e("button",{type:"submit",class:"btn btn-primary"},"確定"),e("button",{type:"reset",class:"btn btn-danger"},"取消")],-1),Le={__name:"ArticleModal",props:["article"],setup(U,{expose:k}){const w=y(null),n=y(""),r=y(""),S=U,u=q(),{getArticle:C}=u,{article:t}=F(u),V={title:void 0,url:void 0,file:void 0,date:void 0,author:void 0,content:void 0};let c;I(function(){c=new B(w.value),r.value=""}),z(()=>S.article,async function(d){d.id?await C(d.id,"admin"):t.value=d,n.value=d.image}),k({show:v});function v(){c.show()}function i(){c.hide(),u.getArticles(1,"admin")}function $(d){var l;(l=t.value).tag||(l.tag=[]),t.value.tag.push(d),r.value=""}function O(d){t.value.tag=t.value.tag.filter(l=>l!==d)}function P(){var d;t.value.create_at=Date.parse(t.value.create_at),(d=t.value).tag||(d.tag=[]),t.value.image=n.value,t.value.id?u.editArticle(t):u.addArticle(t),i()}return(d,l)=>{const f=M("FieldC"),g=M("ErrorMessage"),N=M("FormC");return p(),b("div",{class:"modal fade",ref_key:"DOM",ref:w},[e("div",ee,[s(N,{class:"modal-content",onSubmit:P,onReset:i,"initial-values":o(t),"initial-errors":V},{default:R(({errors:m})=>[e("div",te,h(o(t).id?"編輯":"新增")+"文章",1),e("div",le,[e("div",ae,[oe,e("div",se,[s(f,{label:"標題",name:"title",class:_(["form-control",{"is-invalid":m.title}]),id:"title",type:"text",rules:"required",modelValue:o(t).title,"onUpdate:modelValue":l[0]||(l[0]=a=>o(t).title=a)},null,8,["modelValue","class"]),s(g,{class:"invalid-feedback",name:"title"})])]),e("div",ne,[ie,e("div",de,[e("div",null,[ce,re,e("p",ue,[s(f,{label:"網址",name:"url",rules:"url",type:"text",class:_(["form-control",{"is-invalid":m.url}]),id:"image","aria-describedby":"addImage",placeholder:"請輸入圖片連結",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value=a),standalone:!0},null,8,["modelValue","class"]),e("button",{id:"addImage",type:"button",class:"btn btn-outline-primary btn-sm",onClick:l[2]||(l[2]=a=>o(G)(n.value,x=>o(t).image=x)),disabled:!n.value}," 新增圖片 ",8,me)]),s(g,{class:"invalid-feedback",name:"url"})]),e("div",ve,[_e,s(f,{class:_(["form-control",{"is-invalid":m.file}]),name:"file",type:"file",rules:"image",label:"選取檔案",onChange:l[3]||(l[3]=a=>o(W)(a.target.files,x=>n.value=x)),standalone:!0},null,8,["class"]),s(g,{name:"file",class:"invalid-feedback",style:X({display:m.file?"block":"none"})},null,8,["style"])])])]),e("div",pe,[be,e("div",fe,[Array.isArray(o(t).tag)?(p(),b("p",ge,[(p(!0),b(D,null,L(o(t).tag,a=>(p(),b("span",{class:"badge rounded-pill bg-secondary",key:a},[Y(h(a)+" ",1),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:x=>O(a)},null,8,he)]))),128))])):j("",!0),e("p",ye,[A(e("input",{class:"form-control",id:"tag",type:"text","onUpdate:modelValue":l[4]||(l[4]=a=>r.value=a)},null,512),[[T,r.value]]),e("button",{type:"button",class:"btn btn-outline-primary",onClick:l[5]||(l[5]=a=>$(r.value))},"新增")])])]),e("div",ke,[we,e("div",Ce,[A(e("textarea",{class:"form-control",id:"description",rows:"2",cols:"40","onUpdate:modelValue":l[6]||(l[6]=a=>o(t).description=a)},null,512),[[T,o(t).description]])])]),e("div",Ve,[xe,e("div",Me,[s(f,{label:"內容",as:"textarea",name:"content",class:_(["form-control",{"is-invalid":m.content}]),id:"content",rows:"2",cols:"40",rules:"required",modelValue:o(t).content,"onUpdate:modelValue":l[7]||(l[7]=a=>o(t).content=a)},null,8,["modelValue","class"]),s(g,{class:"invalid-feedback",name:"content"})])]),e("div",Ae,[Se,e("div",$e,[s(f,{label:"作者",name:"author",class:_(["form-control",{"is-invalid":m.author}]),id:"author",type:"text",rules:"required",modelValue:o(t).author,"onUpdate:modelValue":l[8]||(l[8]=a=>o(t).author=a)},null,8,["modelValue","class"]),s(g,{class:"invalid-feedback",name:"author"})])]),e("div",De,[Ue,e("div",Te,[A(e("input",{class:_(["form-check-input",{"is-invalid":m.public}]),id:"public",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=a=>o(t).isPublic=a)},null,2),[[H,o(t).isPublic]])]),Ee,e("div",Fe,[s(f,{label:"建立日期",name:"date",class:_(["form-control",{"is-invalid":m.date}]),id:"date",type:"date",rules:"required",modelValue:o(t).create_at,"onUpdate:modelValue":l[10]||(l[10]=a=>o(t).create_at=a)},null,8,["modelValue","class"]),s(g,{class:"invalid-feedback",name:"date"})])])]),Ie]),_:1},8,["initial-values"])])],512)}}},qe={class:"table"},Oe=e("thead",null,[e("tr",null,[e("th",null,"標題"),e("th",null,"作者"),e("th",null,"建立日期"),e("th",null,"公開"),e("th",null,"動作")])],-1),Pe={class:"btn-group btn-group-sm"},Ne=["onClick"],Be=["onClick"],Ye={__name:"ArticleManage",setup(U){const k=y(null),w=y(null),n=y({}),r=q(),{isLoading:S}=F(J()),u=E(()=>r.articles),C=E(()=>r.pagination);I(async function(){await r.getArticles(1,"admin")});function t(V,c=""){switch(n.value={},V){case"add":n.value={create_at:new Date().toISOString().split("T")[0],tag:[]},k.value.show();break;case"edit":n.value=u.value.find(v=>v.id===c),n.value.create_at=new Date(n.value.create_at).toISOString().split("T")[0],k.value.show();break;case"remove":n.value=u.value.find(v=>v.id===c),w.value.show();break}}return(V,c)=>{const v=M("LoadingC");return p(),b(D,null,[s(v,{"is-full-page":!0,active:o(S)},null,8,["active"]),e("button",{type:"button",class:"float-end btn btn-primary",onClick:c[0]||(c[0]=i=>t("add"))},"新增文章"),e("table",qe,[Oe,e("tbody",null,[(p(!0),b(D,null,L(u.value,i=>(p(),b("tr",{key:i.id},[e("td",null,h(i.title),1),e("td",null,h(i.author),1),e("td",null,h(new Date(i.create_at).toLocaleDateString()),1),e("td",null,h(i.isPublic?"是":"否"),1),e("td",null,[e("div",Pe,[e("button",{class:"btn btn-outline-primary",onClick:$=>t("edit",i.id)},"編輯",8,Ne),e("button",{class:"btn btn-outline-danger",onClick:$=>t("remove",i.id)},"移除",8,Be)])])]))),128))])]),A(s(Q,{pagination:C.value,onPaginate:c[1]||(c[1]=i=>o(r).getArticles(i,"admin"))},null,8,["pagination"]),[[K,C.value.total_pages>1]]),s(Le,{ref_key:"addEditModal",ref:k,article:n.value},null,8,["article"]),s(Z,{type:"文章",ref_key:"removeModal",ref:w,item:n.value},null,8,["item"])],64)}}};export{Ye as default};
