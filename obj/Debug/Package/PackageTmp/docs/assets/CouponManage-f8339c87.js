import{m as y,s as $,o as D,O as q,G as O,r as k,d as w,e as V,h as e,f as a,w as U,t as m,g as n,n as C,q as E,x as B,u as T,c as S,F as x,i as I,v as N}from"./index-76d5b82d.js";import{a as F}from"./coupons-3eb6210c.js";import{_ as R}from"./PaginationBar-07a76f54.js";import{_ as z}from"./RemoveModal-8875dbfd.js";import"./articles-c7527420.js";const G={class:"modal-dialog",role:"dialog"},P={class:"modal-header"},j={class:"modal-body"},A={class:"w-100"},H=e("td",null,"標題",-1),J=e("td",null,"代碼",-1),K=e("td",null,"折扣",-1),Q=e("td",null,"到期日",-1),W=e("td",null,"啟用",-1),X=e("div",{class:"modal-footer"},[e("button",{type:"submit",class:"btn btn-primary"},"確定"),e("button",{type:"reset",class:"btn btn-danger"},"取消")],-1),Y={__name:"CouponModal",props:["coupon"],setup(M,{expose:u}){const f=y(null),o=F(),{coupon:t}=$(o),b=M,p={title:"",percent:"",date:"",code:""};let r;u({show:_}),D(function(){r=new q(f.value)}),O(()=>b.coupon,function(i){t.value=i});function _(){r.show()}function v(){r.hide(),o.getCoupons(1)}function s(){t.value.due_date=Date.parse(t.value.due_date),t.value.id?o.editCoupon(t):o.addCoupon(t),v()}return(i,l)=>{const c=k("FieldC"),g=k("ErrorMessage"),L=k("FormC");return w(),V("div",{class:"modal fade",ref_key:"DOM",ref:f},[e("div",G,[a(L,{class:"modal-content",onSubmit:s,onReset:v,"initial-values":n(t),"initial-errors":p},{default:U(({errors:h})=>[e("div",P,m(n(t).id?"編輯":"新增")+"優惠券",1),e("div",j,[e("table",A,[e("tr",null,[H,e("td",null,[a(c,{label:"標題",name:"title",class:C(["form-control",{"is-invalid":h.title}]),type:"text",rules:"required",modelValue:n(t).title,"onUpdate:modelValue":l[0]||(l[0]=d=>n(t).title=d)},null,8,["modelValue","class"]),a(g,{name:"title",class:"invalid-feedback"})])]),e("tr",null,[J,e("td",null,[a(c,{label:"代碼",name:"code",class:C(["form-control",{"is-invalid":h.code}]),type:"text",rules:"required",modelValue:n(t).code,"onUpdate:modelValue":l[1]||(l[1]=d=>n(t).code=d)},null,8,["modelValue","class"]),a(g,{name:"code",class:"invalid-feedback"})])]),e("tr",null,[K,e("td",null,[a(c,{label:"折扣",name:"discount",class:C(["form-control",{"is-invalid":h.discount}]),type:"number",rules:"required|integer",min:"1",max:"99",modelValue:n(t).percent,"onUpdate:modelValue":l[2]||(l[2]=d=>n(t).percent=d)},null,8,["modelValue","class"]),a(g,{name:"discount",class:"invalid-feedback"})])]),e("tr",null,[Q,e("td",null,[a(c,{label:"到期日",name:"date",class:C(["form-control",{"is-invalid":h.date}]),type:"date",rules:"required",modelValue:n(t).due_date,"onUpdate:modelValue":l[3]||(l[3]=d=>n(t).due_date=d)},null,8,["modelValue","class"]),a(g,{name:"date",class:"invalid-feedback"})])]),e("tr",null,[W,e("td",null,[E(e("input",{name:"enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=d=>n(t).is_enabled=d),"true-value":1,"false-value":0},null,512),[[B,n(t).is_enabled]])])])])]),X]),_:1},8,["initial-values"])])],512)}}},Z={class:"table"},ee=e("thead",null,[e("tr",null,[e("th",null,"標題"),e("th",null,"代碼"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"啟用"),e("th",null,"動作")])],-1),te={class:"btn-group btn-group-sm"},le=["onClick"],ne=["onClick"],ue={__name:"CouponManage",setup(M){const u=F(),{isLoading:f}=$(T()),o=y({}),t=y(null),b=y(null),p=S(()=>u.coupons),r=S(()=>u.pagination);D(async function(){await u.getCoupons(1)});function _(v,s=""){switch(o.value={},v){case"add":o.value={due_date:new Date().toISOString().split("T")[0]},t.value.show();break;case"modify":o.value=p.value.find(i=>i.id===s),o.value.due_date=new Date(o.value.due_date).toISOString().split("T")[0],t.value.show();break;case"remove":o.value=p.value.find(i=>i.id===s),b.value.show()}}return(v,s)=>{const i=k("LoadingC");return w(),V(x,null,[a(i,{"is-full-page":!0,active:n(f)},null,8,["active"]),e("button",{type:"button",class:"btn btn-primary float-end",onClick:s[0]||(s[0]=l=>_("add"))},"新增優惠券"),e("table",Z,[ee,e("tbody",null,[(w(!0),V(x,null,I(p.value,l=>(w(),V("tr",{key:l.id},[e("td",null,m(l.title),1),e("td",null,m(l.code),1),e("td",null,m(l.percent),1),e("td",null,m(new Date(l.due_date).toLocaleDateString()),1),e("td",null,m(l.is_enabled?"已":"未")+"啟用",1),e("td",null,[e("div",te,[e("button",{class:"btn btn-outline-primary",onClick:c=>_("modify",l.id)},"編輯",8,le),e("button",{class:"btn btn-outline-danger",onClick:c=>_("remove",l.id)},"移除",8,ne)])])]))),128))])]),E(a(R,{pagination:r.value,onPaginate:s[1]||(s[1]=l=>n(u).getCoupon(l,"admin"))},null,8,["pagination"]),[[N,r.value.total_pages>1]]),a(Y,{ref_key:"addEditModal",ref:t,coupon:o.value},null,8,["coupon"]),a(z,{ref_key:"removeModal",ref:b,item:o.value,type:"優惠券"},null,8,["item"])],64)}}};export{ue as default};
